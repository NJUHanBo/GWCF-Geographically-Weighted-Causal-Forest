% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/00_data_prep.R
\name{prep_from_raster}
\alias{prep_from_raster}
\title{Prepare Data from Raster}
\usage{
prep_from_raster(
  y_raster,
  w_raster,
  x_rasters,
  sample_n = NULL,
  sample_type = c("stratified", "random"),
  n_strata = NULL,
  mask_raster = NULL,
  seed = NULL
)
}
\arguments{
\item{y_raster}{A SpatRaster (terra) or file path for the outcome variable.}

\item{w_raster}{A SpatRaster or file path for the treatment variable.}

\item{x_rasters}{A SpatRaster with multiple layers, or a character vector of file paths
for covariate rasters.}

\item{sample_n}{Optional integer. If specified, samples this many cells
instead of using all valid cells. Useful for large rasters.}

\item{sample_type}{Character, sampling method:
\itemize{
  \item "stratified" (default): Spatially stratified random sampling. Divides
    the study area into grid cells and samples proportionally from each.
    Ensures spatial representativeness.
  \item "random": Simple random sampling. May result in spatial clustering.
}}

\item{n_strata}{Integer, number of spatial strata (grid cells) for stratified
sampling. Default is sqrt(sample_n), capped at 100.}

\item{mask_raster}{Optional SpatRaster to mask the study area.}

\item{seed}{Random seed for reproducible sampling.}
}
\value{
A list with components:
  \item{Y}{Numeric vector of outcomes}
  \item{W}{Numeric vector of treatment}
  \item{X}{Matrix of covariates}
  \item{coords}{Matrix of coordinates (n x 2)}
  \item{crs}{CRS of the rasters}
  \item{n}{Number of observations}
  \item{resolution}{Raster resolution}
}
\description{
Extracts Y, W, X, and coordinates from raster data for use with gw_causal_forest.
Requires the terra package.
}
\examples{
\dontrun{
# Using terra
library(terra)

# Load rasters
y_rast <- rast("outcome.tif")
w_rast <- rast("treatment.tif")
x_rast <- rast(c("covar1.tif", "covar2.tif", "covar3.tif"))

# Prepare data (sample 10000 cells if raster is large)
data <- prep_from_raster(
  y_raster = y_rast,
  w_raster = w_rast,
  x_rasters = x_rast,
  sample_n = 10000,
  seed = 123
)

# Fit model
fit <- gw_causal_forest(
  Y = data$Y,
  W = data$W,
  X = data$X,
  coords = data$coords,
  treatment_type = "continuous"
)
}

}
